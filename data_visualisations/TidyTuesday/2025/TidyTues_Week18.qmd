---
title: "TidyTuesday Week 18: National Science Foundation Grant Terminations under the Trump Administration"
subtitle: "This week we're exploring a dataset of grants for scientific research and education projects from the U.S. National Science Foundation (NSF) that have been terminated by the Trump administration in 2025. In an unprecedented and possibly illegal action, the NSF has terminated over 1,000 such grants starting on April 18, 2025, and terminations continue."
author: "Peter Gray"
date: "2025-05-06" 
categories: ["TidyTuesday", "Data Visualization", "R Programming", "2025"]
tags: [tidytuesday, R, data visulation, ggplot2, patchwork, tidyverse]
image: "thumbnails/TidyTues_Week18.png"
format:
  html:
    toc: true
    toc-depth: 5
    code-link: true
    code-fold: true
    code-tools: false
    code-summary: "Show code"
    self-contained: true
editor_options: 
  chunk_output_type: console
execute: 
  freeze: true                                                  
  cache: true                                                   
  error: false
  message: false
  warning: false
  eval: true
---

::: {#fig-charts layout-ncol="2"}
![](thumbnails/TidyTues_Week18.png){#fig-singlechart}
:::

#### 1. R code

```{r}


# Load the packages in ----------------------------------------------------

if(!require(tidyverse)){install.packages("tidyverse"); library(tidyverse)}
if(!require(patchwork)){install.packages("patchwork"); library(patchwork)}
if(!require(ggplot2)){install.packages("ggplot2"); library(ggplot2)}
# I stick all my styling into a CUsotm PAckage to tidy up my code and keep it consistent over the time
if(!require(CustomGGPlot2Theme)){devtools::install("CustomGGPlot2Theme"); library(CustomGGPlot2Theme)}
if(!require(sf)){install.packages("sf"); library(sf)}
if(!require(scales)){install.packages("scales"); library(scales)}
if(!require(ggrepel)){install.packages("ggrepel"); library(ggrepel)}
if(!require(scatterpie)){install.packages("scatterpie"); library(scatterpie)}

# get the wd - force of habit
wd <- getwd()
#pulling images off internet was taking a lot of time and casing a time out error
options(timeout = 1000) 



font <- "roboto_bold"


nsf_terminations <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-05-06/nsf_terminations.csv')



# Data Cleaning


total_budget_per_state <- nsf_terminations %>%
  mutate(directorate = str_remove_all(directorate, "\"")) %>%
  group_by(org_state, in_cruz_list) %>%
  summarize(total_budget_cancelled = sum(usaspending_obligated, na.rm = TRUE))



# US Map

url <- "https://eric.clst.org/assets/wiki/uploads/Stuff/gz_2010_us_040_00_500k.json"

us_states <- st_read(url)

#need the abbreviations for merging
state_abbrev <- data.frame(
  NAME = state.name,
  ABBR = state.abb,
  stringsAsFactors = FALSE
) %>%
  bind_rows(tibble(NAME = "District of Columbia", ABBR = "DC"))


us_states <- us_states %>%
  left_join(state_abbrev, by = "NAME") %>%
  rename(org_state = ABBR) %>%
  select(-any_of(c("LSAD", "CENSUSAREA")))

rm(state_abbrev)

new <- left_join(total_budget_per_state, us_states, by = "org_state") 


new <- st_as_sf(new)

contiguous_states <- new %>%
  filter(!org_state %in% c( "PR", "GU", "VI", "MP", "AK", "HI","PR"))

# Get state boundaries for CONUS
contiguous_boundaries <- us_states %>%
  filter(!org_state %in% c("PR", "GU", "VI", "MP",  "AK", "HI", "PR"))

# Recalculate centroids and bars
centroids <- st_centroid(contiguous_states)
coords <- st_coordinates(centroids)
contiguous_states$longitude <- coords[, 1]
contiguous_states$latitude <- coords[, 2]
contiguous_states$scaled_budget <- scales::rescale(contiguous_states$total_budget_cancelled, to = c(0, 2))

data <- contiguous_states %>%
  as.data.frame() %>%
  group_by(org_state) %>%
  summarise(
    budget_in_cruz_list = sum(as.numeric(total_budget_cancelled[in_cruz_list == TRUE]), na.rm = TRUE),
    budget_not_in_cruz_list = sum(as.numeric(total_budget_cancelled[in_cruz_list == FALSE]), na.rm = TRUE),
    latitude = first(latitude),
    longitude = first(longitude)
  ) %>%
  arrange(org_state) %>%
  mutate(
    state_number = row_number(),
    radius = sqrt(budget_in_cruz_list + budget_not_in_cruz_list) / 10000,
    total_budget = budget_in_cruz_list + budget_not_in_cruz_list,
    percent_in_cruz = budget_in_cruz_list / total_budget,
    percent_not_in_cruz = budget_not_in_cruz_list / total_budget,
    total_budget_label = paste0("Total Budget Cancelled: \n", scales::dollar(total_budget, scale = 1e-6, suffix = "M"))
  ) %>%
  select(budget_in_cruz_list, budget_not_in_cruz_list, latitude, longitude, state_number, radius, percent_in_cruz, percent_not_in_cruz, total_budget, total_budget_label)

state_names <- contiguous_states %>%
  as.data.frame() %>%
  distinct(NAME, .keep_all = TRUE)

ggplot() +
  geom_sf(data = contiguous_states, fill = alpha("#004225", 0.1), color = "black") +
  geom_scatterpie(
    aes(x = longitude, y = latitude, group = state_number, r = radius),
    data = data,
    cols = c("budget_in_cruz_list", "budget_not_in_cruz_list"),
    color = NA,
    alpha = 0.8,
    label_show_ratio = T
  ) +
   geom_text(data = {data %>%  filter(budget_in_cruz_list != 0)}, aes(y = latitude, x = longitude,
                label = scales::dollar(budget_in_cruz_list, scale = 1e-6, suffix = "M")),
            nudge_y = 0.07, nudge_x = 1, size = 3) +
   geom_text(data = {data %>%  filter(budget_not_in_cruz_list != 0)}, aes(y = latitude, x = longitude,
                label = scales::dollar(budget_not_in_cruz_list, scale = 1e-6, suffix = "M")),
            nudge_y = 0.07, nudge_x = -1, size = 3) +
  geom_text(data = {data %>%  filter(total_budget != 0)}, aes(y = latitude, x = longitude,
                label = total_budget_label),
            nudge_y = -1, nudge_x = 0, size = 3) +
  labs(title = "National Science Foundation Terminations by Trump Administration",
       subtitle = "Week of 18th April to 25th April",
       caption = str_wrap("Data: NSF Terminations | TidyTuesday 2025-05-06 \n In Ted Cruz's list refers to Whether the project was in a list of NSF projects named by U.S. Senator Ted Cruz that he claimed 'promoted Diversity, Equity, and Inclusion (DEI) or advanced neo-Marxist class warfare propaganda.'", 50),
       fill = "Budget Source") +
   scale_fill_discrete(labels = c("Not in Ted Cruz's List", "In Ted Cruz's List")) +
  Custom_Style() +
  theme(panel.grid = element_blank(),
        axis.line = element_blank(),
        axis.text = element_blank(),
        axis.title = element_blank(),
        axis.ticks = element_blank(),
        axis.text.x = element_blank(),
        legend.position = "bottom") 


```
