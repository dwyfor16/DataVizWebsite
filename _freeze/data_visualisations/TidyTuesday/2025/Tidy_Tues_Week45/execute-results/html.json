{
  "hash": "bb5ab8602113f667356d92edc586bbf4",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"TidyTuesday Week 45: WHO TB Burden Data: Incidence, Mortality, and Population\"\nsubtitle: \"This week, we explore global tuberculosis (TB) burden estimates from the World Health Organization, using data curated via the getTBinR R package by Sam Abbott. The dataset includes country-level indicators such as TB incidence, mortality, case detection rates, and population estimates across multiple years. These metrics help researchers, public health professionals, and learners understand the scale and distribution of TB worldwide.\"\nauthor: \"Peter Gray\"\ndate: \"2025-11-11\" \ncategories: [\"TidyTuesday\", \"Data Visualization\", \"Python Programming\", \"2025\"]\ntags: [tidytuesday, python, data visulation, ggplot2, tidyverse]\nimage: \"thumbnails/TidyTues_Week45.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: false\n    code-summary: \"Show code\"\n    self-contained: true\neditor_options: \n  chunk_output_type: console\nexecute: \n  freeze: true                                                  \n  cache: true                                                   \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n![Chart](thumbnails/TidyTues_Week45.png){#fig-singlechart}\nArea plot of TB numbers over the years\n\n\n\n#### 1. Python code\n\n::: {#f65df488 .cell fig-show='none' message='false' execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport matplotlib.ticker as mticker\n\n# Load data\nwho_tb_data = pd.read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-11-11/who_tb_data.csv')\n\n# Select and summarize\ndf = who_tb_data[[\"country\", \"year\", \"g_whoregion\", \"c_cdr\", \"e_mort_num\", \"e_inc_num\", \"e_mort_exc_tbhiv_num\", \"e_mort_tbhiv_num\"]]\n\nmort_summary = (\n    df.groupby([\"g_whoregion\", \"year\"], as_index=False)\n      .agg({\"e_mort_exc_tbhiv_num\": \"sum\", \"e_mort_tbhiv_num\": \"sum\"})\n      .rename(columns={\n          \"e_mort_exc_tbhiv_num\": \"mort_nonhiv\",\n          \"e_mort_tbhiv_num\": \"mort_hiv\"\n      })\n)\n\n# Reshape long\nmort_summary = mort_summary.melt(\n    id_vars=[\"g_whoregion\", \"year\"],\n    value_vars=[\"mort_nonhiv\", \"mort_hiv\"],\n    var_name=\"mort_type\",\n    value_name=\"deaths\"\n)\n\n# Rename and order mortality types\nmort_summary['mort_type'] = mort_summary['mort_type'].map({\n    'mort_hiv': 'HIV related Tuberculosis Death',\n    'mort_nonhiv': 'Non-HIV related Tuberculosis Death'\n})\n\nmort_summary['mort_type'] = pd.Categorical(\n    mort_summary['mort_type'],\n    categories=[\n        'Non-HIV related Tuberculosis Death',\n        'HIV related Tuberculosis Death'\n    ],\n    ordered=True\n)\n\n# Determine plot structure\nmort_types = mort_summary['mort_type'].unique()\nfig, axes = plt.subplots(1, len(mort_types), figsize=(14, 6), sharey=True)\n\nif len(mort_types) == 1:\n    axes = [axes]\n\nfor ax, mtype in zip(axes, mort_types):\n    subset = mort_summary[mort_summary['mort_type'] == mtype]\n    pivot_df = subset.pivot_table(\n        index='year', columns='g_whoregion', values='deaths', aggfunc='sum'\n    ).fillna(0)\n\n    ax.stackplot(\n        pivot_df.index,\n        pivot_df.T.values,\n        labels=pivot_df.columns\n    )\n\n    ax.set_title(mtype)\n    ax.set_xlabel(\"Year\")\n    ax.set_ylabel(\"Deaths\")\n    ax.grid(False)\n    ax.spines['top'].set_visible(False)\n    ax.spines['right'].set_visible(False)\n    ax.spines['left'].set_color(\"darkgrey\")\n    ax.spines['bottom'].set_color(\"darkgrey\")\n    ax.yaxis.set_major_formatter(mticker.StrMethodFormatter('{x:,.0f}'))\n\nfig.legend(\n    pivot_df.columns,\n    bbox_to_anchor=(0.5, -0.08),\n    title=\"WHO-Defined Region\",\n    loc=\"lower center\",\n    ncol=3,\n    frameon=False\n)\nfig.suptitle(\"Non-HIV and HIV-related Tuberculosis deaths per WHO-Region\", fontsize=14)\nplt.tight_layout(rect=[0, 0, 1, 0.95])\n\n```\n:::\n\n\n",
    "supporting": [
      "Tidy_Tues_Week45_files"
    ],
    "filters": [],
    "includes": {}
  }
}