{
  "hash": "8429c75f9e009477bb0736235799a459",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"TidyTuesday Week 18: National Science Foundation Grant Terminations under the Trump Administration\"\nsubtitle: \"This week we're exploring a dataset of grants for scientific research and education projects from the U.S. National Science Foundation (NSF) that have been terminated by the Trump administration in 2025. In an unprecedented and possibly illegal action, the NSF has terminated over 1,000 such grants starting on April 18, 2025, and terminations continue.\"\nauthor: \"Peter Gray\"\ndate: \"2025-05-06\" \ncategories: [\"TidyTuesday\", \"Data Visualization\", \"R Programming\", \"2025\"]\ntags: [tidytuesday, R, data visulation, ggplot2, patchwork, tidyverse]\nimage: \"thumbnails/TidyTues_Week18.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: false\n    code-summary: \"Show code\"\n    self-contained: true\neditor_options: \n  chunk_output_type: console\nexecute: \n  freeze: true                                                  \n  cache: true                                                   \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n\n::: {#fig-charts layout-ncol=\"2\"}\n![](thumbnails/TidyTues_Week18.png){#fig-singlechart}\n:::\n\n#### 1. R code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the packages in ----------------------------------------------------\n\nif(!require(tidyverse)){install.packages(\"tidyverse\"); library(tidyverse)}\nif(!require(patchwork)){install.packages(\"patchwork\"); library(patchwork)}\nif(!require(ggplot2)){install.packages(\"ggplot2\"); library(ggplot2)}\n# I stick all my styling into a CUsotm PAckage to tidy up my code and keep it consistent over the time\nif(!require(CustomGGPlot2Theme)){devtools::install(\"CustomGGPlot2Theme\"); library(CustomGGPlot2Theme)}\nif(!require(sf)){install.packages(\"sf\"); library(sf)}\nif(!require(scales)){install.packages(\"scales\"); library(scales)}\nif(!require(ggrepel)){install.packages(\"ggrepel\"); library(ggrepel)}\nif(!require(scatterpie)){install.packages(\"scatterpie\"); library(scatterpie)}\n\n# get the wd - force of habit\nwd <- getwd()\n#pulling images off internet was taking a lot of time and casing a time out error\noptions(timeout = 1000) \n\n\n\nfont <- \"roboto_bold\"\n\n\nnsf_terminations <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-05-06/nsf_terminations.csv')\n\n\n\n# Data Cleaning\n\n\ntotal_budget_per_state <- nsf_terminations %>%\n  mutate(directorate = str_remove_all(directorate, \"\\\"\")) %>%\n  group_by(org_state, in_cruz_list) %>%\n  summarize(total_budget_cancelled = sum(usaspending_obligated, na.rm = TRUE))\n\n\n\n# US Map\n\nurl <- \"https://eric.clst.org/assets/wiki/uploads/Stuff/gz_2010_us_040_00_500k.json\"\n\nus_states <- st_read(url)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `gz_2010_us_040_00_500k' from data source \n  `https://eric.clst.org/assets/wiki/uploads/Stuff/gz_2010_us_040_00_500k.json' \n  using driver `GeoJSON'\nSimple feature collection with 52 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -179.1473 ymin: 17.88481 xmax: 179.7785 ymax: 71.35256\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\n#need the abbreviations for merging\nstate_abbrev <- data.frame(\n  NAME = state.name,\n  ABBR = state.abb,\n  stringsAsFactors = FALSE\n) %>%\n  bind_rows(tibble(NAME = \"District of Columbia\", ABBR = \"DC\"))\n\n\nus_states <- us_states %>%\n  left_join(state_abbrev, by = \"NAME\") %>%\n  rename(org_state = ABBR) %>%\n  select(-any_of(c(\"LSAD\", \"CENSUSAREA\")))\n\nrm(state_abbrev)\n\nnew <- left_join(total_budget_per_state, us_states, by = \"org_state\") \n\n\nnew <- st_as_sf(new)\n\ncontiguous_states <- new %>%\n  filter(!org_state %in% c( \"PR\", \"GU\", \"VI\", \"MP\", \"AK\", \"HI\",\"PR\"))\n\n# Get state boundaries for CONUS\ncontiguous_boundaries <- us_states %>%\n  filter(!org_state %in% c(\"PR\", \"GU\", \"VI\", \"MP\",  \"AK\", \"HI\", \"PR\"))\n\n# Recalculate centroids and bars\ncentroids <- st_centroid(contiguous_states)\ncoords <- st_coordinates(centroids)\ncontiguous_states$longitude <- coords[, 1]\ncontiguous_states$latitude <- coords[, 2]\ncontiguous_states$scaled_budget <- scales::rescale(contiguous_states$total_budget_cancelled, to = c(0, 2))\n\ndata <- contiguous_states %>%\n  as.data.frame() %>%\n  group_by(org_state) %>%\n  summarise(\n    budget_in_cruz_list = sum(as.numeric(total_budget_cancelled[in_cruz_list == TRUE]), na.rm = TRUE),\n    budget_not_in_cruz_list = sum(as.numeric(total_budget_cancelled[in_cruz_list == FALSE]), na.rm = TRUE),\n    latitude = first(latitude),\n    longitude = first(longitude)\n  ) %>%\n  arrange(org_state) %>%\n  mutate(\n    state_number = row_number(),\n    radius = sqrt(budget_in_cruz_list + budget_not_in_cruz_list) / 10000,\n    total_budget = budget_in_cruz_list + budget_not_in_cruz_list,\n    percent_in_cruz = budget_in_cruz_list / total_budget,\n    percent_not_in_cruz = budget_not_in_cruz_list / total_budget,\n    total_budget_label = paste0(\"Total Budget Cancelled: \\n\", scales::dollar(total_budget, scale = 1e-6, suffix = \"M\"))\n  ) %>%\n  select(budget_in_cruz_list, budget_not_in_cruz_list, latitude, longitude, state_number, radius, percent_in_cruz, percent_not_in_cruz, total_budget, total_budget_label)\n\nstate_names <- contiguous_states %>%\n  as.data.frame() %>%\n  distinct(NAME, .keep_all = TRUE)\n\nggplot() +\n  geom_sf(data = contiguous_states, fill = alpha(\"#004225\", 0.1), color = \"black\") +\n  geom_scatterpie(\n    aes(x = longitude, y = latitude, group = state_number, r = radius),\n    data = data,\n    cols = c(\"budget_in_cruz_list\", \"budget_not_in_cruz_list\"),\n    color = NA,\n    alpha = 0.8,\n    label_show_ratio = T\n  ) +\n   geom_text(data = {data %>%  filter(budget_in_cruz_list != 0)}, aes(y = latitude, x = longitude,\n                label = scales::dollar(budget_in_cruz_list, scale = 1e-6, suffix = \"M\")),\n            nudge_y = 0.07, nudge_x = 1, size = 3) +\n   geom_text(data = {data %>%  filter(budget_not_in_cruz_list != 0)}, aes(y = latitude, x = longitude,\n                label = scales::dollar(budget_not_in_cruz_list, scale = 1e-6, suffix = \"M\")),\n            nudge_y = 0.07, nudge_x = -1, size = 3) +\n  geom_text(data = {data %>%  filter(total_budget != 0)}, aes(y = latitude, x = longitude,\n                label = total_budget_label),\n            nudge_y = -1, nudge_x = 0, size = 3) +\n  labs(title = \"National Science Foundation Terminations by Trump Administration\",\n       subtitle = \"Week of 18th April to 25th April\",\n       caption = str_wrap(\"Data: NSF Terminations | TidyTuesday 2025-05-06 \\n In Ted Cruz's list refers to Whether the project was in a list of NSF projects named by U.S. Senator Ted Cruz that he claimed 'promoted Diversity, Equity, and Inclusion (DEI) or advanced neo-Marxist class warfare propaganda.'\", 50),\n       fill = \"Budget Source\") +\n   scale_fill_discrete(labels = c(\"Not in Ted Cruz's List\", \"In Ted Cruz's List\")) +\n  Custom_Style() +\n  theme(panel.grid = element_blank(),\n        axis.line = element_blank(),\n        axis.text = element_blank(),\n        axis.title = element_blank(),\n        axis.ticks = element_blank(),\n        axis.text.x = element_blank(),\n        legend.position = \"bottom\") \n```\n\n::: {.cell-output-display}\n![](TidyTues_Week18_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}